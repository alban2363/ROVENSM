//Auteur : Malo Selosse 
//projet : Réalisation d'un pilote automatique 
// Ce code permet de récupérer les données de cap BRUT du magnétomètre BMM150

//Branchement du capteur 
//Noir sur GND
//Rouge sur 5V
//SDA sur SDA 
//SCL sur SCL 

#include <bmm150_defs.h>
#include <DFRobot_BMM150.h>
#include "DFRobot_BMM150.h"
DFRobot_BMM150_I2C bmm150(&Wire, I2C_ADDRESS_4);
#define BMM150_CS D3

unsigned int Te, Tch ; // Variables pour la gestion du temps 
unsigned long DateEch, DateChgt ; //Dates 
int dt = 100 ; //durée en millisecondes souhaitée entre 2 cycles, période d'échantiollonage 

void setup() 
{
  Serial.begin(115200);
  while(!Serial);
  while(bmm150.begin()){
    Serial.println("bmm150 init failed, Please try again!");
    delay(1000);
  } Serial.println("bmm150 init success!");

  bmm150.setOperationMode(BMM150_POWERMODE_NORMAL);//Normal mode

  bmm150.setPresetMode(BMM150_PRESETMODE_HIGHACCURACY);//High-accuracy mode

  bmm150.setRate(BMM150_DATA_RATE_10HZ);//10HZ

  bmm150.setMeasurementXYZ();//Default config of X-, Y-, and Z-axis
}

void loop()
{
  Te = millis() - DateEch ; //temps d'échantillonage 

  if ( Te>=dt) {
    DateEch = millis() ; //dateEch = temps actuel

    float capActuel = bmm150.getCompassDegree();// CapActuel prend la valeurs des données brutes du capteur
    Serial.println(capActuel);
  }
  
}
